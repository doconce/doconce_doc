<!--
File automatically generated using DocOnce (https://github.com/doconce/doconce/):
doconce format html development.do.txt --html_style=bootswatch_readable --html_code_style=inherit --no_abort --no_mako
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/doconce/doconce/" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Getting Started with Development">
<title>Getting Started with Development</title>
<!-- Bootstrap style: bootswatch_readable -->
<!-- doconce format html development.do.txt --html_style=bootswatch_readable --html_code_style=inherit --no_abort --no_mako -->
<link href="https://netdna.bootstrapcdn.com/bootswatch/3.1.1/readable/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->
<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }
/* Add scrollbar to dropdown menus in bootstrap navigation bar */
.dropdown-menu {
   height: auto;
   max-height: 400px;
   overflow-x: hidden;
}
/* Adds an invisible element before each target to offset for the navigation
   bar */
.anchor::before {
  content:"";
  display:block;
  height:64px;      /* fixed header height for style bootswatch_readable */
  margin:-64px 0 0; /* negative fixed header height */
}
</style>
</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Program Structure', 1, None, 'program-structure'),
              ('The entry point `bin/doconce`',
               2,
               None,
               'the-entry-point-bin-doconce'),
              ('Python scripts in `lib/doconce/`',
               2,
               None,
               'python-scripts-in-lib-doconce'),
              ('Synching the `docs` and `test` folders',
               2,
               None,
               'synching-the-docs-and-test-folders'),
              ('Running Tests', 2, None, 'running-tests'),
              ('Running DocOnce in a IDE', 1, 'section:IDE', 'section:IDE'),
              ('Compiling the Documentation',
               1,
               None,
               'compiling-the-documentation'),
              ('Add a New Language', 1, None, 'add-a-new-language'),
              ('Push your code using git',
               1,
               None,
               'push-your-code-using-git')]}
end of tocinfo -->

<body>
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="development.html">Getting Started with Development</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="#program-structure" style="font-size: 80%;"><b>Program Structure</b></a></li>
     <!-- navigation toc: --> <li><a href="#the-entry-point-bin-doconce" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;The entry point <code>bin/doconce</code></a></li>
     <!-- navigation toc: --> <li><a href="#python-scripts-in-lib-doconce" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Python scripts in <code>lib/doconce/</code></a></li>
     <!-- navigation toc: --> <li><a href="#synching-the-docs-and-test-folders" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Synching the <code>docs</code> and <code>test</code> folders</a></li>
     <!-- navigation toc: --> <li><a href="#running-tests" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Running Tests</a></li>
     <!-- navigation toc: --> <li><a href="#section:IDE" style="font-size: 80%;"><b>Running DocOnce in a IDE</b></a></li>
     <!-- navigation toc: --> <li><a href="#compiling-the-documentation" style="font-size: 80%;"><b>Compiling the Documentation</b></a></li>
     <!-- navigation toc: --> <li><a href="#add-a-new-language" style="font-size: 80%;"><b>Add a New Language</b></a></li>
     <!-- navigation toc: --> <li><a href="#push-your-code-using-git" style="font-size: 80%;"><b>Push your code using git</b></a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->
<div class="container">
<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->
<!-- ------------------- main content ---------------------- -->
<div class="jumbotron">
<center>
<h1>Getting Started with Development</h1>
</center>  <!-- document title -->

<!-- author(s): Alessandro Marin -->
<center>
<b>Alessandro Marin</b> 
</center>
<!-- institution -->
<center>
<b>Center for Computation in Science Education (CCSE), Department of Physics, University of Oslo</b>
</center>
<br>
<center>
<h4>Aug 18, 2021</h4>
</center> <!-- date -->
<br>

<p>DocOnce is an open source project. 
The aim of this guide is to help getting started with development. It describes the program's structure and how to set up a script that runs DocOnce from a Python IDE.
</p>


</div> <!-- end jumbotron -->
<h1 id="program-structure" class="anchor">Program Structure </h1>
<h2 id="the-entry-point-bin-doconce" class="anchor">The entry point <code>bin/doconce</code> </h2>
<p>The entry point of the doconce program is the file <code>bin/doconce</code>. In fact, the <code>setup.py</code> file contains this line invoking the <code>scripts</code> option to run commands from terminal:</p>


<!-- code=python (!bc pycod-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">setup(<span style="color: #666666">...</span>,
  scripts <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;bin/doconce&#39;</span>],
)
</pre>
</div>
      </div>
    </div>
  </div>
</div>

<p>Read more about <code>setup.py</code> on this page: <a href="https://docs.python.org/3/distutils/setupscript.html#installing-scripts" target="_self">setuptools</a></p>

<p>The <code>main</code> function in <code>/bin/doconce</code> starts processing the <code>doconce</code> command and sends it to different scripts. </p>

<p>Any <code>doconce format</code> command is passed to the <code>format()</code> function, which in turn calls <code>format_driver()</code> in <code>lib/doconce/doconce.py</code>. </p>

<p>The <code>doconce format --help</code> command is passed help_format(). Other commands including undefined ones are handled locally. </p>

<p>Most of the commands are handled by the <code>eval</code> function: </p>


<!-- code=python (!bc pycod-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">retval <span style="color: #666666">=</span> <span style="color: #008000">eval</span>(command <span style="color: #666666">+</span> <span style="color: #BA2121">&#39;()&#39;</span>)
</pre>
</div>
      </div>
    </div>
  </div>
</div>

<p>which passes execution to specific function that are imported in the beginning of the script.</p>
<h2 id="python-scripts-in-lib-doconce" class="anchor">Python scripts in <code>lib/doconce/</code> </h2>

<p>The <code>lib/doconce/</code> directory contains the scripts to run DocOnce. The name of the files give a clue about their purpose, e.g. <code>html.py</code> contains code that is run by <code>doconce format html</code>. The <code>doconce.py</code> file contains important formatting functions such as <code>doconce_format()</code>, <code>preprocess()</code>, <code>doconce2format()</code>, <code>file2file()</code>. </p>

<p>I suggest navigating through the scripts by using an IDE with debugger. See the 
the section <a href="#section:IDE">Running DocOnce in a IDE</a>.
</p>
<h2 id="synching-the-docs-and-test-folders" class="anchor">Synching the <code>docs</code> and <code>test</code> folders </h2>

<p>The documentation and tests for DocOnce are stored in their own GitHub repositories: <a href="https://github.com/doconce/doconce_doc" target="_self">doconce_doc</a> and <a href="https://github.com/doconce/doconce_tests" target="_self">doconce_tests</a>, respectively. 
These two repositories are <a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules" target="_self">git-submodules</a>, i.e. they are included in the main <a href="https://github.com/doconce/doconce" target="_self">doconce</a> repository as subdirectories. 
The subdirectories for <a href="https://github.com/doconce/doconce_doc" target="_self">doconce_doc</a> and <a href="https://github.com/doconce/doconce_tests" target="_self">doconce_tests</a> are the <code>doc</code> and <code>test</code> folders, respectively. 
This structure was chosen to improve modularization and the disk footprint of the main <a href="https://github.com/doconce/doconce" target="_self">doconce</a> repository.
</p>

<p>The content of the <code>doc</code> and <code>test</code> folders can be downloaded by running this command after cloning the <a href="https://github.com/doconce/doconce" target="_self">doconce</a> repository:</p>


<!-- code=bash (!bc shcod-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">git submodule update --init
</pre>
</div>
      </div>
    </div>
  </div>
</div>
<h2 id="running-tests" class="anchor">Running Tests </h2>

<p>Tests are implemented in the <a href="https://github.com/doconce/doconce_tests" target="_self">doconce_tests</a> <a href="https://git-scm.com/book/en/v2/Git-Tools-Submodule" target="_self">git-submodule</a>, which can be downloaded as explained above to the <code>test</code> folder. </p>

<p>See the instructions in the <code>test/README.md</code> file to install additional requirements for the tests and how to run them.</p>
<h1 id="section:IDE" class="anchor">Running DocOnce in a IDE</h1>

<p>The following code can be used in a IDE such as <a href="https://www.jetbrains.com/pycharm/" target="_self">PyCharm</a>, <a href="https://www.eclipse.org/" target="_self">Eclipse</a>, <a href="https://visualstudio.microsoft.com/" target="_self">Microsoft Visual Studio</a>, or others.</p>


<!-- code=python (!bc pycod-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">sys</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">os</span>
<span style="color: #408080; font-style: italic"># Add the doconce installation directory to the path</span>
HOME <span style="color: #666666">=</span> os<span style="color: #666666">.</span>getenv(<span style="color: #BA2121">&quot;HOME&quot;</span>)
sys<span style="color: #666666">.</span>path<span style="color: #666666">.</span>insert(<span style="color: #666666">0</span>, os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>join(HOME, <span style="color: #BA2121">&#39;doconce/lib&#39;</span>))
<span style="color: #408080; font-style: italic"># Load the doconce.py file</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">doconce</span> <span style="color: #008000; font-weight: bold">import</span> doconce

<span style="color: #408080; font-style: italic"># Format to html</span>
os<span style="color: #666666">.</span>chdir(os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>join(HOME, <span style="color: #BA2121">&#39;doconce/test&#39;</span>))
sys<span style="color: #666666">.</span>argv <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;doconce format&#39;</span>, <span style="color: #BA2121">&#39;html&#39;</span>, <span style="color: #BA2121">&#39;testdoc.do.txt&#39;</span>,<span style="color: #BA2121">&#39;--html_output=temp&#39;</span>,<span style="color: #BA2121">&#39;--execute&#39;</span>]
doconce<span style="color: #666666">.</span>format_driver()
sys<span style="color: #666666">.</span>exit()  <span style="color: #408080; font-style: italic">#stop execution here</span>

<span style="color: #408080; font-style: italic"># Create a jupyterbook</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">doconce.jupyterbook</span> <span style="color: #008000; font-weight: bold">import</span> jupyterbook
os<span style="color: #666666">.</span>chdir(os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>join(HOME, <span style="color: #BA2121">&#39;doconce/test/mybook&#39;</span>))
sys<span style="color: #666666">.</span>argv <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;doconce jupyterbook&#39;</span>, <span style="color: #BA2121">&#39;jupyterbook.do.txt&#39;</span>,
            <span style="color: #BA2121">&#39;--sep=section&#39;</span>, <span style="color: #BA2121">&#39;--sep_section=subsection&#39;</span>,
            <span style="color: #BA2121">&#39;--dest=content&#39;</span>,<span style="color: #BA2121">&#39;--dest_toc=.&#39;</span>,
            <span style="color: #BA2121">&#39;--titles=titles.txt&#39;</span>, 
            <span style="color: #BA2121">&#39;--allow_refs_to_external_docs&#39;</span>]
jupyterbook()
<span style="color: #008000">print</span>(os<span style="color: #666666">.</span>system(<span style="color: #BA2121">&#39;jupyter-book build .&#39;</span>));
sys<span style="color: #666666">.</span>exit()  <span style="color: #408080; font-style: italic">#stop execution here</span>

<span style="color: #408080; font-style: italic"># Format to latex</span>
os<span style="color: #666666">.</span>chdir(os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>join(HOME, <span style="color: #BA2121">&#39;doconce/test&#39;</span>))
sys<span style="color: #666666">.</span>argv <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;doconce format&#39;</span>, <span style="color: #BA2121">&#39;latex&#39;</span>, <span style="color: #BA2121">&#39;execute.do.txt&#39;</span>, 
            <span style="color: #BA2121">&#39;--execute&#39;</span>, 
            <span style="color: #BA2121">&#39;--latex_font=helvetica&#39;</span>, <span style="color: #BA2121">&#39;--latex_code_style=pyg&#39;</span>]
doconce<span style="color: #666666">.</span>format_driver()
<span style="color: #408080; font-style: italic"># Run a function in a py script</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">doconce.misc</span> <span style="color: #008000; font-weight: bold">import</span> ptex2tex;
ptex2tex()
os<span style="color: #666666">.</span>system(<span style="color: #BA2121">&#39;pdflatex -shell-escape execute.tex&#39;</span>);
os<span style="color: #666666">.</span>system(<span style="color: #BA2121">&#39;dvipdf execute.dvi&#39;</span>);
os<span style="color: #666666">.</span>system(<span style="color: #BA2121">&#39;xreader execute.pdf&#39;</span>);
</pre>
</div>
      </div>
    </div>
  </div>
</div>

<p>As an example for PyCharm, see the guide <a href="https://www.jetbrains.com/help/pycharm/creating-and-editing-run-debug-configurations.html" target="_self">Create and edit run/debug configurations&#65279;</a> to set up create and edit run/debug configurations&#65279;. I suggest using a virtual environment as <a href="https://www.jetbrains.com/help/pycharm/python-interpreters.html" target="_self">Python interpreter</a>. Also install DocOnce in development mode so that the <code>doconce</code> command will get updated when you edit its code:</p>


<!-- code=bash (!bc shcod-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;"><span style="color: #408080; font-style: italic"># Create a virtual environment</span>
python -m venv venv
<span style="color: #008000">source</span> venv/bin/activate
<span style="color: #408080; font-style: italic"># Install dependencies and DocOnce in development mode</span>
<span style="color: #666666">(</span>venv<span style="color: #666666">)</span> pip install -r requirements.txt
<span style="color: #666666">(</span>venv<span style="color: #666666">)</span> pip install -e .
</pre>
</div>
      </div>
    </div>
  </div>
</div>
<h1 id="compiling-the-documentation" class="anchor">Compiling the Documentation </h1>

<p>The documentation is implemented in the <a href="https://github.com/doconce/doconce_doc" target="_self">doconce_doc</a> <a href="https://git-scm.com/book/en/v2/Git-Tools-Submodule" target="_self">git-submodule</a>, which can be downloaded as explained above to the <code>doc</code> folder. </p>

<p>The documentation is written as DocOnce <code>.do.txt</code> files in different folder inside <code>doc/src/</code>, for example <code>doc/src/manual/</code>, <code>doc/src/quickref/</code>, <code>doc/src/tutorial/</code>. These folders contains a <code>make.sh</code> file that can be run in <code>bash</code> to create documentation in  different formats: </p>


<!-- code=bash (!bc shcod-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">bash make.sh
</pre>
</div>
      </div>
    </div>
  </div>
</div>

<p>All relevant output files are copied to <code>doc/pub</code> for publication on the github website.</p>
<h1 id="add-a-new-language" class="anchor">Add a New Language </h1>

<p>The translations are defined in the <code>lib/doconce/globals.py</code> file, and test files are in the <a href="https://github.com/doconce/doconce/tree/master/doc/src/locale" target="_self">locale</a> directory. Also read the <a href="https://doconce.github.io/doconce/doc/pub/manual/manual.html#support-for-non-english" target="_self">Support for non-English</a> section of the manual. </p>
<h1 id="push-your-code-using-git" class="anchor">Push your code using git </h1>

<p>I suggest the following procedure</p>

<ul>
<li> Creating a fork of the <a href="https://github.com/doconce/doconce" target="_self">doconce/doconce</a> repository in your GitHub account;</li> 
<li> Add <a href="https://github.com/doconce/doconce" target="_self">doconce/doconce</a> as an upstream repository:</li>
</ul>

<!-- code=bash (!bc shcod-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">git remote add upstream https://github.com/doconce/doconce.git
git remote -v     <span style="color: #408080; font-style: italic"># verify, there should be two `origin` and two `upstream`</span>
</pre>
</div>
      </div>
    </div>
  </div>
</div>

<ul>
<li> Edit/develop new code there (you might want to use git branches);</li> 
<li> You might have creted new/untracked files. Decide which ons you want to keep, then delete the rest:</li>
</ul>

<!-- code=bash (!bc shcod-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;"><span style="color: #408080; font-style: italic"># Keep some files</span>
git add -f keep_this_file.txt
<span style="color: #008000">cd</span> <span style="color: #008000">test</span>
git add -f keep_this_file_in_test.txt
<span style="color: #008000">cd</span> ..
<span style="color: #408080; font-style: italic"># This removes all new/untracked files</span>
git submodule foreach git clean -fd
git clean -fd
</pre>
</div>
      </div>
    </div>
  </div>
</div>

<ul>
<li> Run <code>git add .</code> and <code>git commit</code> on submodules, then on the superproject:</li>
</ul>

<!-- code=bash (!bc shcod-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;"><span style="color: #408080; font-style: italic"># First add and commit in submodules ..</span>
<span style="color: #008000">cd</span> doc
git add .
git commit -am <span style="color: #BA2121">&quot;commit changes in doc submodule&quot;</span>
<span style="color: #008000">cd</span> ..
<span style="color: #008000">cd</span> <span style="color: #008000">test</span>
git add . 
git commit -am <span style="color: #BA2121">&quot;commit changes in test submodule&quot;</span>
<span style="color: #008000">cd</span> ..
<span style="color: #408080; font-style: italic"># .. then do the same in the superproject</span>
git add -A .
git commit -am <span style="color: #BA2121">&quot;some description&quot;</span>
</pre>
</div>
      </div>
    </div>
  </div>
</div>

<ul>
<li> Push all commits to your forked repository:</li>
</ul>

<!-- code=bash (!bc shcod-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">git push --recurse-submodules<span style="color: #666666">=</span>on-demand
</pre>
</div>
      </div>
    </div>
  </div>
</div>

<ul>
<li> Navigate to the <a href="https://github.com/doconce/doconce" target="_self">doconce/doconce</a> repository and create a Pull Request. In brief: Pull Request button > New pull request button > click on the "compare across forks" link > Use the boxes below the link to compare with your fork</li>
<li> To update your local fork repository do the following:</li>
</ul>

<!-- code=bash (!bc shcod-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">git checkout main     <span style="color: #408080; font-style: italic"># Switch to the main branch</span>
git fetch upstream 
git rebase upstream/main  Update the code to the remote version <span style="color: #666666">(</span>the main DocOnce repository<span style="color: #666666">)</span>
git push              <span style="color: #408080; font-style: italic">#Push the updates to my fork</span>
</pre>
</div>
      </div>
    </div>
  </div>
</div>
<!-- ------------------- end of main content --------------- -->
</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<!-- Bootstrap footer
<footer>
<a href="https://..."><img width="250" align=right src="https://..."></a>
</footer>
-->
</body>
</html>


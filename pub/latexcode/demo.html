<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Demonstration of DocOnce support for LaTeX code block environments">

<title>Demonstration of DocOnce support for LaTeX code block environments</title>

<!-- Bootstrap style: bootstrap_bloodish -->
<link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_styles/style_bootstrap/css/bootstrap_bloodish.css" rel="stylesheet">
<!-- not necessary
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }

/* Add scrollbar to dropdown menus in bootstrap navigation bar */
.dropdown-menu {
   height: auto;
   max-height: 400px;
   overflow-x: hidden;
}
</style>


<!-- USER-DEFINED ENVIRONMENTS -->

</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Blocks of computer code in LaTeX', 1, None, '___sec0'),
              ('History', 2, 'latexcode:history', 'latexcode:history'),
              ('Quick overview of the functionality',
               2,
               'latexcode:overview',
               'latexcode:overview'),
              ('The simplest choice: a single LaTeX environment for all blocks',
               2,
               'latexcode:uniform',
               'latexcode:uniform'),
              ('Using the `minted` (Pygments) tool',
               2,
               'latexcode:pyg',
               'latexcode:pyg'),
              ('Using the `lstlisting` tool',
               2,
               'latexcode:lst',
               'latexcode:lst'),
              ('Specifying other packages',
               2,
               'latexcode:any',
               'latexcode:any'),
              ('Adding a colored background',
               2,
               'latexcode:background',
               'latexcode:background'),
              ('Setting LaTeX environment parameters',
               2,
               'latexcode:latex:prms',
               'latexcode:latex:prms'),
              ('Specifying individual code environments',
               2,
               'latexcode:nonuniform',
               'latexcode:nonuniform'),
              ('Specifying the `lst` style',
               2,
               'latexcode:lst:style',
               'latexcode:lst:style'),
              ('General syntax for `--latex_code_style=`',
               2,
               'latexcode:syntax',
               'latexcode:syntax'),
              ('Wrapping code environments with user-customized environments',
               2,
               'latexcode:userdef',
               'latexcode:userdef')]}
end of tocinfo -->

<body>

    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="demo.html">Demonstration of DocOnce support for LaTeX code block environments</a>
  </div>

  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="#___sec0" style="font-size: 80%;"><b>Blocks of computer code in LaTeX</b></a></li>
     <!-- navigation toc: --> <li><a href="#latexcode:history" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;History</a></li>
     <!-- navigation toc: --> <li><a href="#latexcode:overview" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Quick overview of the functionality</a></li>
     <!-- navigation toc: --> <li><a href="#latexcode:uniform" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;The simplest choice: a single LaTeX environment for all blocks</a></li>
     <!-- navigation toc: --> <li><a href="#latexcode:pyg" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Using the <code>minted</code> (Pygments) tool</a></li>
     <!-- navigation toc: --> <li><a href="#latexcode:lst" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Using the <code>lstlisting</code> tool</a></li>
     <!-- navigation toc: --> <li><a href="#latexcode:any" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Specifying other packages</a></li>
     <!-- navigation toc: --> <li><a href="#latexcode:background" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Adding a colored background</a></li>
     <!-- navigation toc: --> <li><a href="#latexcode:latex:prms" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Setting LaTeX environment parameters</a></li>
     <!-- navigation toc: --> <li><a href="#latexcode:nonuniform" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Specifying individual code environments</a></li>
     <!-- navigation toc: --> <li><a href="#latexcode:lst:style" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Specifying the <code>lst</code> style</a></li>
     <!-- navigation toc: --> <li><a href="#latexcode:syntax" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;General syntax for <code>--latex_code_style=</code></a></li>
     <!-- navigation toc: --> <li><a href="#latexcode:userdef" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Wrapping code environments with user-customized environments</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<!-- ------------------- main content ---------------------- -->



<div class="jumbotron">
<center><h1>Demonstration of DocOnce support for LaTeX code block environments</h1></center>  <!-- document title -->

<p>
<!-- author(s): Hans Petter Langtangen -->

<center>
<b>Hans Petter Langtangen</b> [1, 2]
</center>

<p>
<!-- institution(s) -->

<center>[1] <b>Center for Biomedical Computing, Simula Research Laboratory</b></center>
<center>[2] <b>Department of Informatics, University of Oslo</b></center>
<br>
<p>
<center><h4>Apr 8, 2016</h4></center> <!-- date -->
<br>
<p>
<b>Summary.</b> This note demonstrates the DocOnce capabilities for generating LaTeX
code for verbatim blocks of computer code. These new capabilities
replaces the need for both the stand-alone program <code>ptex2tex</code> and
the simplified <code>doconce ptex2tex</code> utility. In fact, the
new capabilities are more flexible than <code>ptex2tex</code> and results in
much cleaner LaTeX code (especially for verbatim blocks with
background color).

<p>
</div> <!-- end jumbotron -->

<h1 id="___sec0">Blocks of computer code in LaTeX </h1>

<h2 id="latexcode:history">History</h2>

<p>
Originally, DocOnce relied on generating code for <code>ptex2tex</code> rather than
plain LaTeX, the reason being that <code>ptex2tex</code> offered about 40 different
styles for typesetting verbatim blocks of code. The <code>ptex2tex</code> utility
relies on a comprehensive configure file for setting the style of every
code environment (<code>pycod</code>, <code>fpro</code>, <code>sys</code>, etc.). A simpler and quicker
alternative, <code>doconce ptex2tex</code> was developed later such that DocOnce
was not dependent on the comprehensive <code>ptex2tex</code> set up.

<p>
In 2015, a new implementation in DocOnce replaced <code>ptex2tex</code> and
<code>doconce ptex2tex</code>, and can in fact generate LaTeX code directly.
Rather than offering a range of packages for typesetting computer
code, as the <code>ptex2tex</code> tool does, the implementation made use of only
three choices: <code>fancyvrb</code>, <code>minted</code>, or <code>listing</code>, but these choices
with all their parameters actually span a much richer way of
typesetting code than what <code>ptex2tex</code> offers.

<h2 id="latexcode:overview">Quick overview of the functionality</h2>

<p>
When running <code>doconce format latex mydoc</code> or <code>doconce format pdflatex mydoc</code>,
the command-line argument <code>--latex_code_style=...</code> specifies the typesetting
of blocks of computer code. The result of the <code>doconce format</code> command
is then a LaTeX file <code>mydoc.tex</code>, which can be processed by <code>latex</code>,
<code>pdflatex</code>, or <code>xelatex</code>.

<p>
We use the term <em>code environment</em> for the DocOnce environments in which
blocks of code are typset. For example, the <code>pycod</code> environment is
surrounded by the <code>!bc pycod</code> and <code>!ec</code> directives. DocOnce supports
a lot of such environments: <code>pycod</code> for code snippets in Python, <code>pypro</code>
for complete executable Python programs, <code>fcod</code> and <code>fpro</code> for
snippets and complete programs in Fortran, <code>cppcod</code> and <code>cpppro</code> for
the C++ counterparts, <code>mcod</code> and <code>mpro</code> for Matlab, to mention some.

<p>
The user can choose between three well-known packages for typesetting
computer code in LaTeX:

<ul>
 <li> <code>vrb</code>: <code>fancyvrb</code> and the <code>Verbatim</code> LaTeX environment</li>
 <li> <code>pyg</code>: <code>minted</code>, i.e., the Pygments tool, and the <code>minted</code> LaTeX environment</li>
 <li> <code>lst</code>: <code>listingsutf8</code> and the <code>lstlisting</code> LaTeX environment</li>
 <li> <code>any</code>: any environment named <code>any</code> from any package</li>
</ul>

The terms <code>vrb</code>, <code>pyg</code>, <code>lst</code>, and <code>any</code> are the terms for these
packages/environments on the command line when running <code>doconce format</code>.

<p>
In addition, the user can specify a possibly colored background for
the blocks of computer code and also set the parameters in the
various environments. This information can be specified for each
DocOnce code environment (<code>pycod</code>, <code>sys</code>, etc.) independently, including a
common default choice for the code environments that are not specified.

<h2 id="latexcode:uniform">The simplest choice: a single LaTeX environment for all blocks</h2>

<p>
The following command speficies the <code>Verbatim</code> (<code>vrb</code>)
environment for all code blocks:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex mydoc --latex_code_style=vrb
</pre></div>
<p>
A <a href="doc.do.txt.html" target="_blank">DocOnce demo document</a> has been made to illustrate
how the various typesettings look like. The document contains
a data file with the code environment <code>dat</code>, a complete executable
Python program in the code environment <code>pypro</code>, and a terminal session
in the code environment <code>sys</code>. The result of
<code>--latex_code_style=vrb</code> gives the most plain and standard way of
typesetting verbatim code blocks in LaTeX, see <a href="doc_vrb.pdf" target="_blank">the result</a>.
Or more precisely, DocOnce generates a <code>Verbatim</code> environment with
several parameters set:

<p>

<!-- code=latex (!bc latexcod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">\begin</span><span style="color: #008000">{</span>Verbatim<span style="color: #008000">}</span>[numbers=none,fontsize=<span style="color: #008000; font-weight: bold">\\</span>fontsize<span style="color: #008000">{</span>9pt<span style="color: #008000">}{</span>9pt<span style="color: #008000">}</span>,<span style="color: #408080; font-style: italic">%</span>
                 baselinestretch=0.95,xleftmargin=2mm]
...
<span style="color: #008000; font-weight: bold">\end</span><span style="color: #008000">{</span>Verbatim<span style="color: #008000">}</span>
</pre></div>
<p>
This results in slightly smaller font and slightly squeezed lines in
the code block. It matches well running text in 10pt font.

<p>
The <code>xleftmargin=2mm</code> parameter can be explicitly set to something
else on the command line: <code>--latex_code_leftmargin=7</code> (e.g.). The number
is measured in mm. (Using square brackets, as shown below, it can also
be set individually for different code environments.)

<h2 id="latexcode:pyg">Using the <code>minted</code> (Pygments) tool</h2>

<p>
Replacing <code>vrb</code> by <code>pyg</code> switches the LaTeX environments to <code>minted</code>:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex mydoc --latex_code_style=pyg
</pre></div>
<p>
Now, <a href="doc_pyg.pdf" target="_blank">the resulting PDF file</a>
has typesetting of computer code that depends
on the programming language. For example, the Python program leads to

<p>

<!-- code=latex (!bc latexcod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">\begin</span><span style="color: #008000">{</span>minted<span style="color: #008000">}</span>[<span style="color: #408080; font-style: italic">%</span>
   fontsize=<span style="color: #008000; font-weight: bold">\\</span>fontsize<span style="color: #008000">{</span>9pt<span style="color: #008000">}{</span>9pt<span style="color: #008000">}</span>,linenos=false,<span style="color: #408080; font-style: italic">%</span>
   baselinestretch=1.0,fontfamily=tt,xleftmargin=2mm]<span style="color: #008000">{</span>python<span style="color: #008000">}</span>
...
<span style="color: #008000; font-weight: bold">\end</span><span style="color: #008000">{</span>minted<span style="color: #008000">}</span>
</pre></div>
<p>
<div class="alert alert-block alert-danger alert-text-normal"><b>Remember <code>-shell-escape</code> when compiling <code>minted</code> (Pygments) code!</b>
The <code>minted</code> LaTeX environment requires <code>latex</code> or <code>pdflatex</code> to be
run with the <code>-shell-escape</code> option:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">Terminal&gt; pdflatex -shell-escape mydoc
</pre></div>
<p>
</div>


<p>
The <code>minted</code> style to be used can be
specified by the <code>--minted_latex_style=</code> option, e.g.,

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex mydoc --latex_code_style=vrb --minted_latex_style=perldoc
</pre></div>
<p>
The <code>perldoc</code> choice <a href="doc_pyg_perldoc.pdf" target="_blank">changes the colors</a> from
the default (Pygments <code>default</code>) <a href="doc_pyg.pdf" target="_blank">choice</a> generated previously.

<h2 id="latexcode:lst">Using the <code>lstlisting</code> tool</h2>

<p>
The third package for typesetting of verbatim blocks of code is
<code>listingsutf8</code> and the <code>lstlisting</code> LaTeX environment, which in
the following most plain form gives a <a href="doc_lst.pdf" target="_blank">look</a> not
much different from the <code>Verbatim</code> environment:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex mydoc --latex_code_style=lst
</pre></div>
<p>
The resulting LaTeX code is:

<p>

<!-- code=latex (!bc latexcod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">\begin</span><span style="color: #008000">{</span>lstlisting<span style="color: #008000">}</span>[language=Python,style=simple,xleftmargin=2mm]
...
<span style="color: #008000; font-weight: bold">\end</span><span style="color: #008000">{</span>listlisting<span style="color: #008000">}</span>
</pre></div>
<p>
However, all possible <code>lstlisting</code> options can be set, as will
be shown later.

<h2 id="latexcode:any">Specifying other packages</h2>

<p>
Say you have a LaTeX package <code>compcode</code> with the environment <code>ultimate</code>
that you want to use. This can be specified by

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex mydoc \
          --latex_code_style=ultimate --latex_packages=compcode
</pre></div>
<p>
The resulting LaTeX code becomes

<p>

<!-- code=latex (!bc latexcod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">\begin</span><span style="color: #008000">{</span>ultimate<span style="color: #008000">}</span>
...
<span style="color: #008000; font-weight: bold">\end</span><span style="color: #008000">{</span>ultimate<span style="color: #008000">}</span>
</pre></div>

<h2 id="latexcode:background">Adding a colored background</h2>

<p>
In the previous example, we can add one of the predefined backgrounds
in DocOnce:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">doconce format pdflatex doc --latex_code_style=lst-yellow2
</pre></div>
<p>
The <code>yellow2</code> background is <a href="doc_lst_yellow2.pdf" target="_blank">light yellow</a>.
For colored backgrounds, one should notice that the <code>pro</code> code environments
(as in <code>pypro</code>)
for complete executable programs get a 1mm slightly darker bar at the left
side of the code block. This almost invisible color change indicates for
the reader that the code can be copied and run as it stands.
(The <code>cod</code> code environments are used for snippets that will not
normally run unless some additional statements is supplied.)

<p>
The general specification of a background is <code>pkg-bg</code>, where
<code>pkg</code> is the package specification (<code>vrb</code>, <code>pyg</code>, or <code>lst</code>) and <code>bg</code>
is the DocOnce name of a background:

<ul>
 <li> <code>gray</code>: light gray</li>
 <li> <code>yellowgray</code>: light yellow, somewhat gray-ish</li>
 <li> <code>yellow1</code>: yellow</li>
 <li> <code>yellow2</code>: light yellow</li>
 <li> <code>blue1</code>: light blue</li>
 <li> <code>red1</code>: light red, somewhat apricot-ish</li>
 <li> <code>white</code>: no background</li>
</ul>

If you want to tailor the background color, say change the <code>yellow1</code>
color to have RGB values (0.95, 0.95, 0.8) rather than (0.98, 0.98, 0.8),
autoedit the <code>.tex</code> file with a regular expression:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce subst &#39;yellow1\}\{rgb.+&#39; \
          &#39;yellow1{rgb}{0.95, 0.95, 0.8} mydoc.tex
</pre></div>
<p>
or just replace the exact text:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce replace \
          &#39;cbg_yellow1}{rgb}{.98, .98, 0.8}&#39; \
          &#39;cbg_yellow1}{rgb}{.95, .95, 0.8}&#39; mydoc.tex
</pre></div>

<h2 id="latexcode:latex:prms">Setting LaTeX environment parameters</h2>

<p>
It is easy to specify parameters to the <code>lstlisting</code> or the two
other LaTeX environments:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex doc \
&quot;--latex_code_style=lst-yellow2[numbers=left,
numberstyle=\\tiny,numbersep=15pt,breaklines=true]&quot;
</pre></div>
<p>
(but no linebreaks in the <code>--latex_code_style</code> command!).
These parameters specify <a href="doc_lst_yellow2_linenos.pdf" target="_blank">line numbers in the code blocks</a> as well as wrapping of too long lines (<code>breaklines=true</code>).
<em>Note that any backslash in LaTeX command must be a
double backslash</em> on the command line!

<p>
Here is an example where we use the fictitious code enviroment <code>ultimate</code>
from the package <code>compcode</code> with a yellow backgrund and with some
environment parameters <code>arg1</code> and <code>arg2</code>:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex mydoc --latex_packages=compcode \
         &#39;--latex_code_style=ultimate-yellow2[arg1=val1,arg2=val2]&#39;
</pre></div>
<p>
The resulting LaTeX code becomes

<p>

<!-- code=latex (!bc latexcod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">\begin</span><span style="color: #008000">{</span>cod<span style="color: #008000">}{</span>cbg<span style="color: #008000">_</span>yellow2<span style="color: #008000">}</span><span style="color: #008000; font-weight: bold">\begin</span><span style="color: #008000">{</span>ultimate<span style="color: #008000">}</span>[arg1=val1,arg2=val2]
...
<span style="color: #008000; font-weight: bold">\end</span><span style="color: #008000">{</span>ultimate<span style="color: #008000">}</span><span style="color: #008000; font-weight: bold">\end</span><span style="color: #008000">{</span>cod<span style="color: #008000">}</span>
</pre></div>
<p>
In this way, you can use any environment in any package for typesetting
code.

<h2 id="latexcode:nonuniform">Specifying individual code environments</h2>

<p>
The colored background might be appropriate for computer code in the
previous example, but maybe not so appropriate for the terminal
session. Let us typeset the terminal session using the <code>Verbatim</code>
environment, but rely on <code>lst</code> without line numbers as above for the
other code environments:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex doc \
          &quot;--latex_code_style=default:lst-yellow2@sys:vrb&quot;
</pre></div>
<p>
That is, we specify  the default choice (<code>default</code>) and the <code>sys</code>
environment. The specifications are separated by <code>@</code>. One can
add parameters to the LaTeX environments, e.g.,

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex doc \
  &quot;--latex_code_style=default:lst-yellow2[numbers=left]@sys:vrb&quot;
</pre></div>
<p>
Here is a more fancy typesetting of <code>sys</code> environments with lines
above and below and a title <code>Terminal</code> inside a box:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex doc \
&quot;--latex_code_style=default:lst-yellow2@
sys:vrb[frame=lines,label=\\fbox{{\\tiny Terminal}},framesep=2.5mm,
framerule=0.7pt,fontsize=\fontsize{9pt}{9pt}]&quot;
</pre></div>
<p>
(with no linebreaks though!).
<a href="doc_lst_sys.pdf" target="_blank">Here is the result</a>.

<h2 id="latexcode:lst:style">Specifying the <code>lst</code> style</h2>

<p>
DocOnce comes with some predefined styles for the <code>lstlisting</code> LaTeX
environment:

<ul>
 <li> <code>simple</code> for no coloring of code (plain verbatim style)</li>
 <li> <code>redblue</code> for coloring of code dominated by red and blue</li>
 <li> <code>greenblue</code> for coloring of code dominated by green and blue</li>
 <li> <code>gray</code> for a framed gray background and no code coloring</li>
 <li> <code>graycolor</code> for a framed gray background and green comments, pink keywords,
   red strings, and orange variables</li>
 <li> <code>blue1</code> for a light blue/cyan background with no code coloring</li>
 <li> <code>blue1bar</code> for a light blue/cyan background with a darker think frame
   and with no code coloring</li>
 <li> <code>blue1_bluegreen</code> colored code with blue background (combination of
   <code>blue1</code> background and <code>bluegreen</code> syntax coloring)</li>
 <li> <code>blue1bar_bluegreen</code> colored code with blue background and darker
    frame (combination of
   <code>blue1bar</code> background and <code>bluegreen</code> syntax coloring)</li>
 <li> <code>yellow2_fb</code> for a framed yellow (<code>yellow2</code>) background and
   green comments, blue keywords, red strings, and orange variables
   (the style from the FEniCS book)
   of code <em>and</em> a background color equal to <code>yellow2</code></li>
</ul>

The styles with a colored background (<code>yellow2_fb</code>, <code>gray</code>, <code>graycolor</code>,
<code>blue1</code>)
should of course not be combined with another colored background
(skip <code>backgroundcolor</code> specification or set it to <code>white</code>).

<p>
The user can also define any number of additional styles and put them
in a file, say <code>.mylststyles</code>, and give them to <code>doconce format</code> through
the command-line option <code>--latex_code_lststyles=.mylststyles</code>.
Just include <code>\lstdefinestyle{name}{...}</code> commands in the file.

<p>
Here is an example of specifying the <code>yellow2_fb</code> style with yellow
background, coloring of code, and a frame around all code blocks
(as made famous in the <a href="http://goo.gl/myz5yp" target="_blank">FEniCS book</a>):

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex doc \
  &quot;--latex_code_style=default:lst[style=yellow2_fb]&quot;
</pre></div>
<p>
You may check out the <a href="doc_lst_style_fenicsbook.pdf" target="_blank">corresponding result</a>.

<p>
Blue background and plain verbatim non-colored code (as made
famous in the <a href="http://goo.gl/OKDAzs" target="_blank">Python Primer on Scientific Programming book</a>) results from

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex doc \
&quot;--latex_code_style=default:lst[style=blue1]@
pypro:lst[style=blue1bar]@dat:lst[style=gray]@
sys:vrb[frame=lines,label=\\fbox{{\tiny Terminal}},
framesep=2.5mm,framerule=0.7pt,fontsize=\fontsize{9pt}{9pt}]&quot;
</pre></div>
<p>
(but no linebreaks as here).
Note that this style does not offer the thin vertical darker-colored bar
for <code>pypro</code> enviroments (indicating complete programs) as
<code>ptex2tex</code> offers through the <code>BlueBar</code> environment. Instead, there is a
<a href="doc_lst_styleprimer.pdf" target="_blank">darker-colored top+bottom frame</a> around <code>pypro</code> code specifications.
(The old vertical bar is enabled by a <code>pypro:vrb-blue1</code> specification, but then
with a colored background that is significantly larger than the computer code
block.)

<p>
The 5th edition of the mention &quot;Primer book&quot; features syntax highlighting,
offered by the <code>blue1_bluegreen</code> and <code>blue1bar_bluegreen</code> styles:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; doconce format pdflatex doc \
&quot;--latex_code_style=default:lst[style=blue1_bluegreen]@
pypro:lst[style=blue1bar_bluegreen]@dat:lst[style=gray]@
sys:vrb[frame=lines,label=\\fbox{{\tiny Terminal}},
framesep=2.5mm,framerule=0.7pt,fontsize=\fontsize{9pt}{9pt}]&quot;
</pre></div>
<p>
(but no linebreaks as here). Look at <a href="doc_lst_style_primer5.pdf" target="_blank">the result</a>.

<h2 id="latexcode:syntax">General syntax for <code>--latex_code_style=</code></h2>

<p>
The <code>--latex_code_style=</code> option can take a set of code environment
specifications separated by <code>@</code>. Each specification is of the form
<code>envir:pgk-bg[prms]</code>,
where <code>envir</code> is the code environment name (<code>pypro</code>, <code>sys</code>, etc., or <code>default</code>),
<code>pkg</code> is the package name (<code>vrb</code>, <code>pyg</code>, <code>lst</code>), <code>bg</code> is
the DocOnce name of a potential background (can be omitted), and
<code>prms</code> is a list of parameters for the LaTeX environment.

<p>
As an example, we may specify a default typesetting with <code>lst</code> and the <code>blue1</code>
background, using the <code>greenblue</code> style and numbering of lines;
then we let the <code>dat</code> environment be typeset with the <code>Verbatim</code>
environment with a light gray background; and finally we let <code>sys</code> also use
<code>Verbatim</code>, but with many parameters for more fancy layout. The
value of <code>--latex_code_style=</code> is then (split over several lines for
increased readability - it must be one line as a terminal command!):

<p>

<!-- code=text typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">&quot;--latex_code_style=default:lst-blue1[style=greenblue,
numbers=left,numberstyle=\\tiny,stepnumber=3,
numbersep=15pt,xleftmargin=1mm]@dat:vrb-gray@
sys:vrb[frame=lines,label=\\fbox{{\\tiny Terminal}},
framesep=2.5mm,framerule=0.7pt,fontsize=\fontsize{9pt}{9pt}]&quot;
</pre></div>
<p>
Here is the <a href="doc_lots.pdf" target="_blank">result</a> of this detailed specification.

<p>
<div class="alert alert-block alert-success alert-text-normal"><b>Size of colored background.</b>
The default colored background, as specified by (e.g.) <code>vrb-blue</code>,
is significantly larger than the
verbatim text. The surrounding space can be reduced by setting
<code>\fboxsep</code> to a negative value,
see the line right before the definition of the <code>cod</code>
environment in the <code>.tex</code> file. However, if a <code>!bbox</code> is used in
the document, <code>\fboxsep</code> cannot be set to a negative value without
destroying those boxes. If one really wants the colored background
to be about as large as the text, there is at present two options:

<ol>
<li> use <code>lst</code> with a style (<code>gray</code>, <code>yellow2_fb</code>, <code>blue1</code>)</li>
<li> use <code>ptex2tex</code> with the <code>Blue</code> and similar environments in the
   <code>.ptex2tex.cfg</code> file.</li>
</ol>

The results are very similar so there is no demand for <code>ptex2tex</code>.
</div>


<h2 id="latexcode:userdef">Wrapping code environments with user-customized environments</h2>

<p>
Suppose you want to typeset your code with an environment that is not
supported by DocOnce. For example, we want in LaTeX to have headline
before each code snippet with a section-based counter, the filename
and some title for the code. Then we want double lines before and
after the code snippet:

<p>
<br />
<br />

<p>
<center><p><img src="fig/userdef_code_envir.png" align="bottom" width=500></p></center>

<p>
<br />
<br />

<p>
This is fairly easy: we define a <em>user-defined environment</em> in
DocOnce, here called <code>code</code> and provide a Python module that translates
this environment into proper format-specific code.
Details are provided in the DocOnce manual, see the section
<a href="http://hplgit.github.io/doconce/doc/pub/manual/html/manual.html#user-defined-environments" target="_blank">User-Defined Environments</a>. In the present case,
the syntax in a DocOnce file is to wrap every <code>@@@CODE</code> line or
<code>!bc</code> environment in a <code>!bu-code</code> and <code>!eu-code</code> environment. The
code in the figure above is produced by

<p>

<!-- code=doconce (!bc do) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">!bu-code file=process.f Return `a` multiplied by `c`
!bc fcod
       subroutine process(a, n, c, r)
C      Return array r = c*a
       integer n
       real*8 a(n), c, r(n)
       integer i
       do i = 1,n
          r(i) = c*a(i)
       end do
       return
       end
!ec
!eu-code
</pre></div>
<p>
The LaTX code we want is

<p>

<!-- code=latex (!bc latexcod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">\begin</span><span style="color: #008000">{</span>pycode<span style="color: #008000">}</span>

<span style="color: #008000; font-weight: bold">\Verb</span>!process.f!:
Return a multiplied by <span style="color: #008000; font-weight: bold">\Verb</span>!c!

<span style="color: #008000; font-weight: bold">\hrule</span>
<span style="color: #008000; font-weight: bold">\vspace</span><span style="color: #008000">{</span>1mm<span style="color: #008000">}</span>
<span style="color: #008000; font-weight: bold">\hrule</span>

<span style="color: #008000; font-weight: bold">\begin</span><span style="color: #008000">{</span>lstlisting<span style="color: #008000">}</span>[language=Fortran,style=simple,xleftmargin=2mm]
       subroutine process(a, n, c, r)
C      Return array r = c*a
       integer n
       real*8 a(n), c, r(n)
       integer i
       do i = 1,n
          r(i) = c*a(i)
       end do
       return
       end
<span style="color: #008000; font-weight: bold">\end</span><span style="color: #008000">{</span>lstlisting<span style="color: #008000">}</span>

<span style="color: #008000; font-weight: bold">\hrule</span>
<span style="color: #008000; font-weight: bold">\vspace</span><span style="color: #008000">{</span>1mm<span style="color: #008000">}</span>
<span style="color: #008000; font-weight: bold">\hrule</span>
<span style="color: #008000; font-weight: bold">\end</span><span style="color: #008000">{</span>pycode<span style="color: #008000">}</span>
</pre></div>
<p>
We have created a special LaTeX environment
(&quot;theorem&quot;) called
<code>pycode</code> that LaTeX will give a section-based
number (just like theorems, examples, etc).

<p>
To this end, we must write a file <code>userdef_environments.py</code>
where we define the <code>code</code> environment for LaTeX and
other formats (usually some tailored LaTeX code and just some reasonable
common DocOnce code for other formats). The <code>userdef_environments.py</code>
file looks like this in the current example:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">re</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">latex_code</span>(text, titleline, counter, format):
    <span style="color: #408080; font-style: italic"># file=myprog.py label=my:label Some title...</span>
    label, titleline <span style="color: #666666">=</span> get_label(titleline, <span style="color: #BA2121">&#39;label&#39;</span>)
    filename, titleline <span style="color: #666666">=</span> get_label(titleline, <span style="color: #BA2121">&#39;file&#39;</span>)
    <span style="color: #408080; font-style: italic"># Must be able to handle empty label and/or filename</span>
    <span style="color: #408080; font-style: italic"># (recognized by &#39;&#39;)</span>
    <span style="color: #008000; font-weight: bold">if</span> label:
        label <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;label{</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">}&#39;</span> <span style="color: #666666">%</span> label
    <span style="color: #008000; font-weight: bold">if</span> filename:
        filename <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;`</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">`: &#39;</span> <span style="color: #666666">%</span> filename
    s <span style="color: #666666">=</span> <span style="color: #BA2121">r&quot;&quot;&quot;</span>

<span style="color: #BA2121">\begin{pycode}</span>
<span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121"></span>
<span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121"></span>
<span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121"></span>

<span style="color: #BA2121">\hrule</span>
<span style="color: #BA2121">\vspace{1mm}</span>
<span style="color: #BA2121">\hrule</span>

<span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121"></span>

<span style="color: #BA2121">\hrule</span>
<span style="color: #BA2121">\vspace{1mm}</span>
<span style="color: #BA2121">\hrule</span>
<span style="color: #BA2121">\end{pycode}</span>
<span style="color: #BA2121">&quot;&quot;&quot;</span> <span style="color: #666666">%</span> (label, filename, titleline, text)
    <span style="color: #008000; font-weight: bold">return</span> s

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">do_code</span>(text, titleline, counter, format):
    <span style="color: #408080; font-style: italic"># file=myprog.py label=my:label Some title...</span>
    label, titleline <span style="color: #666666">=</span> get_label(titleline, <span style="color: #BA2121">&#39;label&#39;</span>)
    filename, titleline <span style="color: #666666">=</span> get_label(titleline, <span style="color: #BA2121">&#39;file&#39;</span>)
    s <span style="color: #666666">=</span> <span style="color: #BA2121">r&quot;&quot;&quot;</span>

<span style="color: #BA2121">_Python code </span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">_: `</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">`. </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121"></span>

<span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121"></span>
<span style="color: #BA2121">&quot;&quot;&quot;</span> <span style="color: #666666">%</span> (counter, filename, titleline, text)
    <span style="color: #008000; font-weight: bold">return</span> s


<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_label</span>(titleline, label_text<span style="color: #666666">=</span><span style="color: #BA2121">&#39;label&#39;</span>):
    label <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&#39;</span>
    <span style="color: #008000; font-weight: bold">if</span> label_text <span style="color: #AA22FF; font-weight: bold">in</span> titleline:
        pattern <span style="color: #666666">=</span> <span style="color: #BA2121">r&#39;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">=([^\s]+)&#39;</span> <span style="color: #666666">%</span> label_text
        m <span style="color: #666666">=</span> re<span style="color: #666666">.</span>search(pattern, titleline)
        <span style="color: #008000; font-weight: bold">if</span> m:
            label <span style="color: #666666">=</span> m<span style="color: #666666">.</span>group(<span style="color: #666666">1</span>)
            titleline <span style="color: #666666">=</span> re<span style="color: #666666">.</span>sub(pattern, <span style="color: #BA2121">&#39;&#39;</span>, titleline)<span style="color: #666666">.</span>strip()
    <span style="color: #008000; font-weight: bold">return</span> label, titleline

envir2format <span style="color: #666666">=</span> {
    <span style="color: #BA2121">&#39;intro&#39;</span>: {
        <span style="color: #BA2121">&#39;latex&#39;</span>: <span style="color: #BA2121">r&quot;&quot;&quot;</span>
<span style="color: #BA2121">\usepackage{amsthm}</span>
<span style="color: #BA2121">\theoremstyle{definition}</span>
<span style="color: #BA2121">\newtheorem{pycode}{Python code}[section]</span>
<span style="color: #BA2121">&quot;&quot;&quot;</span>,},
    <span style="color: #BA2121">&#39;code&#39;</span>: {
        <span style="color: #BA2121">&#39;latex&#39;</span>: latex_code,
        <span style="color: #BA2121">&#39;do&#39;</span>: do_code,
        },
}
</pre></div>
<p>
We grab information on
the <code>!bu-code</code> line for a potential filename, label, and header for
the code snippet.

<p>
When compiling to <code>pdflatex</code>, we simply use <code>--latex_code_style=lst</code>,
but we could use more fancy styles if desired.
You can inspect the <a href="doc_udef.pdf" target="_blank">PDF file</a> for this example with
a tailored, user-defined code environment.

<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


</body>
</html>
    


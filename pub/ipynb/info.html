<!--
HTML file automatically generated from DocOnce source
(https://github.com/doconce/doconce/)
doconce format html info.do.txt --html_style=bootstrap_bluegray --html_code_style=inherit --no_preprocess --encoding=utf-8
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/doconce/doconce/" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Special DocOnce features for Jupyter notebooks">
<meta name="keywords" content="headigs,section">
<title>Special DocOnce features for Jupyter notebooks</title>
<!-- Bootstrap style: bootstrap_bluegray -->
<!-- doconce format html info.do.txt --html_style=bootstrap_bluegray --html_code_style=inherit --no_preprocess --encoding=utf-8 -->
<link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<link href="https://raw.githubusercontent.com/doconce/doconce/main/bundled/html_styles/style_bootstrap/css/bootstrap_bluegray.css" rel="stylesheet">
<!-- not necessary
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->
<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }
/* Add scrollbar to dropdown menus in bootstrap navigation bar */
.dropdown-menu {
   height: auto;
   max-height: 400px;
   overflow-x: hidden;
}
/* Adds an invisible element before each target to offset for the navigation
   bar */
.anchor::before {
  content:"";
  display:block;
  height:50px;      /* fixed header height for style bootstrap_bluegray */
  margin:-50px 0 0; /* negative fixed header height */
}
</style>
</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Table of contents',
               1,
               'table_of_contents',
               'table_of_contents'),
              ('Interactive sessions', 1, None, 'interactive-sessions'),
              ("Solving the world's simplest differential equation",
               2,
               'ipynb:de:simplest',
               'ipynb:de:simplest'),
              ('Showing an interactive session as pure text',
               2,
               None,
               'showing-an-interactive-session-as-pure-text'),
              ('Ordinary code blocks', 1, None, 'ordinary-code-blocks'),
              ('Other special options for notebooks',
               1,
               None,
               'other-special-options-for-notebooks'),
              ('Start a new notebook cell',
               2,
               None,
               'start-a-new-notebook-cell'),
              ('Figures and movies', 2, None, 'figures-and-movies'),
              ('Admonitions', 2, None, 'admonitions'),
              ('Equation references', 1, None, 'equation-references'),
              ('Translating notebooks to DocOnce',
               1,
               None,
               'translating-notebooks-to-doconce'),
              ('The `ipynb2doconce` tool', 2, None, 'the-ipynb2doconce-tool'),
              ('Special comment annotations in the `.ipynb` file',
               2,
               None,
               'special-comment-annotations-in-the-ipynb-file')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript" async
 src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="info.html">Special DocOnce features for Jupyter notebooks</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="#table_of_contents" style="font-size: 80%;"><b>Table of contents</b></a></li>
     <!-- navigation toc: --> <li><a href="#interactive-sessions" style="font-size: 80%;"><b>Interactive sessions</b></a></li>
     <!-- navigation toc: --> <li><a href="#ipynb:de:simplest" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Solving the world's simplest differential equation</a></li>
     <!-- navigation toc: --> <li><a href="#showing-an-interactive-session-as-pure-text" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Showing an interactive session as pure text</a></li>
     <!-- navigation toc: --> <li><a href="#ordinary-code-blocks" style="font-size: 80%;"><b>Ordinary code blocks</b></a></li>
     <!-- navigation toc: --> <li><a href="#other-special-options-for-notebooks" style="font-size: 80%;"><b>Other special options for notebooks</b></a></li>
     <!-- navigation toc: --> <li><a href="#start-a-new-notebook-cell" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Start a new notebook cell</a></li>
     <!-- navigation toc: --> <li><a href="#figures-and-movies" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Figures and movies</a></li>
     <!-- navigation toc: --> <li><a href="#admonitions" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Admonitions</a></li>
     <!-- navigation toc: --> <li><a href="#equation-references" style="font-size: 80%;"><b>Equation references</b></a></li>
     <!-- navigation toc: --> <li><a href="#translating-notebooks-to-doconce" style="font-size: 80%;"><b>Translating notebooks to DocOnce</b></a></li>
     <!-- navigation toc: --> <li><a href="#the-ipynb2doconce-tool" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;The <code>ipynb2doconce</code> tool</a></li>
     <!-- navigation toc: --> <li><a href="#special-comment-annotations-in-the-ipynb-file" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Special comment annotations in the <code>.ipynb</code> file</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->
<div class="container">
<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->
<!-- ------------------- main content ---------------------- -->
<div class="jumbotron">
<center>
<h1>Special DocOnce features for Jupyter notebooks</h1>
</center>  <!-- document title -->

<!-- author(s): Hans Petter Langtangen -->
<center>
<b>Hans Petter Langtangen</b> [1, 2]
</center>
<!-- institution(s) -->
<center>
[1] <b>Simula</b>
</center>
<center>
[2] <b>University of Oslo</b>
</center>
<br>
<center>
<h4>Jun 22, 2021</h4>
</center> <!-- date -->
<br>


</div> <!-- end jumbotron -->
<h1 id="table_of_contents">Table of contents</h1>

<div class='toc'>
<p><a href="#interactive-sessions"> Interactive sessions </a></p>
<p><span class="tab"> <a href="#ipynb:de:simplest"> Solving the world's simplest differential equation </a></p>
<p><span class="tab"> <a href="#showing-an-interactive-session-as-pure-text"> Showing an interactive session as pure text </a></p>
<p><a href="#ordinary-code-blocks"> Ordinary code blocks </a></p>
<p><a href="#other-special-options-for-notebooks"> Other special options for notebooks </a></p>
<p><span class="tab"> <a href="#start-a-new-notebook-cell"> Start a new notebook cell </a></p>
<p><span class="tab"> <a href="#figures-and-movies"> Figures and movies </a></p>
<p><span class="tab"> <a href="#admonitions"> Admonitions </a></p>
<p><a href="#equation-references"> Equation references </a></p>
<p><a href="#translating-notebooks-to-doconce"> Translating notebooks to DocOnce </a></p>
<p><span class="tab"> <a href="#the-ipynb2doconce-tool"> The <code>ipynb2doconce</code> tool </a></p>
<p><span class="tab"> <a href="#special-comment-annotations-in-the-ipynb-file"> Special comment annotations in the <code>.ipynb</code> file </a></p>
</div>
<br>

<p>DocOnce enables turning book chapters, manuals, research papers, and in fact any type of document into Jupyter Notebooks
(formerly knowns as IPython Notebooks). This note outlines some special features that one should be aware of and that
can be used to tune the notebook typesetting. 
</p>
<h1 id="interactive-sessions" class="anchor">Interactive sessions </h1>

<p>By default, interactive Python sessions in <code>!bc pyshell</code> and <code>!bc ipy</code> environments are (for the <code>ipynb</code> format)
split such that the output is removed and each input part is a separate cell. This means that when executing
all the cells, one recreates the entire interactive session with all the output. Below is an example.
</p>
<h2 id="ipynb:de:simplest" class="anchor">Solving the world's simplest differential equation</h2>

<p>Let us explore SymPy to solve</p>

$$ y' = y,\quad y(0)=y_0 = 2\thinspace . $$



<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;"><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">sympy</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
<span style="color: #666666">&gt;&gt;&gt;</span> init_printing(use_latex<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>)  <span style="color: #408080; font-style: italic"># find the best method to print</span>
<span style="color: #666666">&gt;&gt;&gt;</span> t <span style="color: #666666">=</span> symbols(<span style="color: #BA2121">&#39;t&#39;</span>, real<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>, positive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>)
<span style="color: #666666">&gt;&gt;&gt;</span> y <span style="color: #666666">=</span> symbols(<span style="color: #BA2121">&#39;y&#39;</span>, <span style="color: #008000">cls</span><span style="color: #666666">=</span>Function)
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #408080; font-style: italic"># Solve differential equation using dsolve</span>
<span style="color: #666666">&gt;&gt;&gt;</span> eq <span style="color: #666666">=</span> diff(y(t), t) <span style="color: #666666">-</span> y(t)
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000">print</span>(eq)
<span style="color: #666666">-</span>y(t) <span style="color: #666666">+</span> Derivative(y(t), t)
<span style="color: #666666">&gt;&gt;&gt;</span> sol <span style="color: #666666">=</span> dsolve(eq)
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000">print</span>(sol)
y(t) <span style="color: #666666">==</span> C1 <span style="color: #666666">*</span> exp(t)
<span style="color: #666666">&gt;&gt;&gt;</span> y <span style="color: #666666">=</span> sol<span style="color: #666666">.</span>rhs          <span style="color: #408080; font-style: italic"># grab right-hand side of equation</span>
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #408080; font-style: italic"># Determine integration constant C1 from initial condition</span>
<span style="color: #666666">&gt;&gt;&gt;</span> C1 <span style="color: #666666">=</span> symbols(<span style="color: #BA2121">&#39;C1&#39;</span>)
<span style="color: #666666">&gt;&gt;&gt;</span> y0 <span style="color: #666666">=</span> <span style="color: #666666">2</span>
<span style="color: #666666">&gt;&gt;&gt;</span> eq <span style="color: #666666">=</span> y<span style="color: #666666">.</span>subs(t, <span style="color: #666666">0</span>) <span style="color: #666666">-</span> y0  <span style="color: #408080; font-style: italic"># equation for initial condition</span>
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000">print</span>(eq)
C1 <span style="color: #666666">-</span> <span style="color: #666666">2</span>
<span style="color: #666666">&gt;&gt;&gt;</span> sol <span style="color: #666666">=</span> solve(eq, C1)     <span style="color: #408080; font-style: italic"># solve wrt C1</span>
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000">print</span>(sol)
[<span style="color: #666666">2</span>]
<span style="color: #666666">&gt;&gt;&gt;</span> y <span style="color: #666666">=</span> y<span style="color: #666666">.</span>subs(C1, sol[<span style="color: #666666">0</span>])  <span style="color: #408080; font-style: italic"># insert C1=2 in solution</span>
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000">print</span>(y)
<span style="color: #666666">2*</span>exp(t)
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000">print</span>(latex(y))
<span style="color: #666666">2</span>e<span style="color: #666666">^</span>{t}
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>The DocOnce input syntax of the first part of the above session looks like this</p>


<!-- code=doconce (!bc do) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">!bc pyshell
&gt;&gt;&gt; from sympy import *
&gt;&gt;&gt; t = symbols(&#39;t&#39;, real=True, positive=True)
&gt;&gt;&gt; y = symbols(&#39;y&#39;, cls=Function)
&gt;&gt;&gt; # Solve differential equation using dsolve
&gt;&gt;&gt; eq = diff(y(t), t) - y(t)
&gt;&gt;&gt; print(eq)
-y(t) + Derivative(y(t), t)
&gt;&gt;&gt; sol = dsolve(eq)
&gt;&gt;&gt; print(sol)
y(t) == C1*exp(t)
...
...
!ec
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>That is, the interactive session looks exactly as it does in the terminal window with the primitive Python shell.</p>

<p>We can, alternatively, use IPython syntax:</p>


<!-- code=doconce (!bc do) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">!bc ipy
In [1]: from sympy import *
In [2]: t = symbols(&#39;t&#39;, real=True, positive=True)
In [3]: y = symbols(&#39;y&#39;, cls=Function)
In [4]: # Solve differential equation using dsolve
In [5]: eq = diff(y(t), t) - y(t)
In [6]: print(eq)
Out[6]: -y(t) + Derivative(y(t), t)
In [7]: sol = dsolve(eq)
In [8]: print(sol)
Out[8]: y(t) == C1*exp(t)
!ec
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>This last <code>ipy</code> environment results in exactly the same interactive session in all formats except <code>ipynb</code> where the
output is removed and the input is split over <em>two</em> cells. In format <b>html</b> the above block is rendered as
</p>


<!-- code=ipy (!bc ipy) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;"><span style="color: #000080; font-weight: bold">In [1]: </span><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">sympy</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
<span style="color: #000080; font-weight: bold">In [2]: </span>t <span style="color: #666666">=</span> symbols(<span style="color: #BA2121">&#39;t&#39;</span>, real<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>, positive<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>)
<span style="color: #000080; font-weight: bold">In [3]: </span>y <span style="color: #666666">=</span> symbols(<span style="color: #BA2121">&#39;y&#39;</span>, <span style="color: #008000">cls</span><span style="color: #666666">=</span>Function)
<span style="color: #000080; font-weight: bold">In [4]: </span><span style="color: #408080; font-style: italic"># Solve differential equation using dsolve</span>
<span style="color: #000080; font-weight: bold">In [5]: </span>eq <span style="color: #666666">=</span> diff(y(t), t) <span style="color: #666666">-</span> y(t)
<span style="color: #000080; font-weight: bold">In [6]: </span><span style="color: #008000">print</span>(eq)
<span style="color: #000080; font-weight: bold">Out[6]: </span><span style="color: #888888">-y(t) + Derivative(y(t), t)</span>
<span style="color: #000080; font-weight: bold">In [7]: </span>sol <span style="color: #666666">=</span> dsolve(eq)
<span style="color: #000080; font-weight: bold">In [8]: </span><span style="color: #008000">print</span>(sol)
<span style="color: #000080; font-weight: bold">Out[8]: </span><span style="color: #888888">y(t) == C1*exp(t)</span>
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>There is an option <code>--ipynb_split_pyshell=off</code> that can be given to <code>doconce format ipynb</code> when compiling documents and
that turns off the behaviour that interactive sessions are split into multiple cells. The result is then one single
cell, and if we have &quot;printing&quot; as in <code>&gt;&gt;&gt; eq</code>, there will be no output, except from the last one, in the output field
in the notebook. This is usually not the behavior you want.
</p>
<h2 id="showing-an-interactive-session-as-pure-text" class="anchor">Showing an interactive session as pure text </h2>

<p>Sometimes one wants to show an interactive session exactly as it looks like, with the input and the output.
This can be done in the notebook by using the <code>pyshell-t</code> or <code>ipy-t</code> environments (<code>-t</code> for <em>plain text</em> display). With
this DocOnce input,
</p>


<!-- code=doconce (!bc do) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">!bc pyshell-t
&gt;&gt;&gt; a = 1
&gt;&gt;&gt; b = 2
&gt;&gt;&gt; a + b
3
!ec
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>we get the plain text</p>


<!-- code=python (!bc pyshell-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;"><span style="color: #666666">&gt;&gt;&gt;</span> a <span style="color: #666666">=</span> <span style="color: #666666">1</span>
<span style="color: #666666">&gt;&gt;&gt;</span> b <span style="color: #666666">=</span> <span style="color: #666666">2</span>
<span style="color: #666666">&gt;&gt;&gt;</span> a <span style="color: #666666">+</span> b
<span style="color: #666666">3</span>
</pre>
</div>
      </div>
    </div>
  </div>
</div>

<p>The <code>-t</code> postfix can be used for any code that you want to display as text rather than as an executable cell. For
example, with <code>!bc pycod-t</code> we create verbatim text and not a cell: 
</p>


<!-- code=python (!bc pycod-t) typeset with pygments style "default-t" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">MySpecialModule</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">m</span>
<span style="color: #008000">print</span>(m<span style="color: #666666">.</span>main())
</pre>
</div>
      </div>
    </div>
  </div>
</div>
<h1 id="ordinary-code-blocks" class="anchor">Ordinary code blocks </h1>

<p>For ordinary book and manual writing, interactive sessions are used when the results of statements are
important. Otherwise one applies standard code blocks. A standard code block can for example be
</p>


<!-- code=doconce (!bc do) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">!bc pycod
x = np.linspace(0, 4*np.pi, 501)
y = np.exp(-0.5*x)*np.sin(np.pi*x)
plt.plot(x, y)
!ec
The result of this code segment appears in Figure ref{myfig1}.

<span style="color: #008000">FIGURE: [fig/myfig, width=500 frac=0.8] Plot. label{myfig1}</span>
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>This snippet turns out fine in all formats, except the notebook. The problem with notebooks is two-fold:</p>

<ol>
<li> The snippet does not run without import of <code>numpy</code> and <code>matplotlib</code>.</li>
<li> The snippet results in a plot automatically, and with the figure in addittion, we get two plots.</li>
</ol>
<p>The remedy for problem 1 is to use <em>hidden code blocks</em>, notified as <code>!bc pyhid</code> for Python code and <code>!bc Xhid</code> in
general for language <code>X</code>:
</p>


<!-- code=doconce (!bc do) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">!bc pyhid
import numpy as np
import matplotlib.pyplot as plt
!ec
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>Such code blocks are invisible in all formats except for <code>ipynb</code>. Books, manuals, and research papers will very often
contain code snippets that do not run without (extensive) extra code. This extra code must be provided in hidden code
blocks for successful conversion to notebooks. If these cells take too much attention (that is probably why they were
left out of the text...), one can insert some comments to explain that fact.
</p>

<p>Problem 2 is solved using one of the preprocessors and an if test on the format, e.g. with Preprocess:</p>


<!-- code=doconce (!bc do) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;"><span style="color: #408080; font-style: italic"># #if FORMAT != &#39;ipynb&#39;</span>
The result of this code segment appears in Figure ref{myfig2}.

<span style="color: #008000">FIGURE: [fig/myfig, width=500 frac=0.8] Plot. label{myfig2}</span>
<span style="color: #408080; font-style: italic"># #endif</span>
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>Now we can write the complete code segment with a preceding hidden block for import and the if test. Below is the
rendering of this in the format <b>html</b>.
</p>

<!-- Note: since Preprocess is used in verbatim block above, we must compile -->
<!-- this document with --no_preprocess and therefore use Mako if test -->
<!-- to test on the format -->



<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">x <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, <span style="color: #666666">4*</span>np<span style="color: #666666">.</span>pi, <span style="color: #666666">501</span>)
y <span style="color: #666666">=</span> np<span style="color: #666666">.</span>exp(<span style="color: #666666">-0.5*</span>x)<span style="color: #666666">*</span>np<span style="color: #666666">.</span>sin(np<span style="color: #666666">.</span>pi<span style="color: #666666">*</span>x)
plt<span style="color: #666666">.</span>plot(x, y)
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>The result of this code segment appears in Figure <a href="#myfig3">1</a>.</p>

<center> <!-- figure label: --> <div id="myfig3"></div> <!-- FIGURE -->
<hr class="figure">
<center>
<p class="caption">Figure 1:  Plot.  <!-- caption label: myfig3 --> </p>
</center>
<p><img src="https://raw.githubusercontent.com/hplgit/doconce/master/doc/src/ipynb/fig/sinplot.html" width="400" align="bottom"></p>
</center>

<p>(Hidden code blocks are also relevant for RunestoneInteractive books, which are made from Sphinx output.)</p>
<h1 id="other-special-options-for-notebooks" class="anchor">Other special options for notebooks </h1>
<h2 id="start-a-new-notebook-cell" class="anchor">Start a new notebook cell </h2>

<p>The <code>!split</code> command starts a new cell.</p>
<h2 id="figures-and-movies" class="anchor">Figures and movies </h2>

<p>Figures and movies can be implemented in several ways in notebooks, depending on the value of the options
<code>--ipynb_figure=</code> and <code>ipynb_movie=</code>. For the former we have the values
</p>

<ul>
 <li> <code>imgtag</code>: <code>&lt;img&gt;</code> HTML tag taking the specified width into account (default)</li>
 <li> <code>md</code>: plain Markdown syntax for a figure, with no possibility to adjust the size (default)</li> 
 <li> <code>Image</code>: Python notebook cell with <code>Image</code> object</li>
</ul>
<p>Below is an example
rendered in format <b>html</b>.
</p>

<br/><br/>
<center>
<p><img src="https://raw.githubusercontent.com/hplgit/doconce/master/doc/src/manual/fig/wave1D.png" width="400" align="bottom"></p>
</center>
<br/><br/>

<p>For the movies we have the values</p>

<ul>
 <li> <code>md</code>: raw HTML code with <code>iframe</code> tag - not relevant for the notebook</li>
 <li> <code>HTML</code>: raw HTML code with <code>iframe</code> tag
<p>    embedded in the <code>HTML</code> object from the notebook (default)</p></li>
 <li> <code>HTML-YouTube</code>: as <code>HTML</code> but use an <code>IPython.display.YouTubeVideo</code> object to display YouTube videos</li>
 <li> <code>ipynb</code>: use <code>IPython.display.YouTubeVideo</code> object for YouTube videos, and use an <code>HTML</code> object with <code>video</code> tag for local movies</li>
</ul>
<p>Below is an example
rendered in format <b>html</b>.
</p>

<iframe width="640" height="480" src="http://youtube.com/embed/PtJrPEIHNJw" frameborder="0" allowfullscreen></iframe>
<h2 id="admonitions" class="anchor">Admonitions </h2>

<p>Markdown has no support for admonitions while DocOnce has extensive support. Some methods for simulating admonitions in
notebooks have therefore been implemented. These are specified by the <code>--ipynb_admon=</code> command-line option.
</p>

<ul>
 <li> <code>quote</code>: typeset admon as Markdown quote (special font and gray vertical bar on the left)</li>
 <li> <code>paragraph</code>: typeset admon as a plain paragraph with a heading if any (default)</li>
 <li> <code>hrule</code>: use a horozontal rule to surround the heading and the text</li>
</ul>
<p>Note that quotes in <code>!bc quote</code> environments are always typeset as Markdown quotes.</p>

<p>Here are two examples
rendered in format <b>html</b> using the default admon typesetting.
</p>

<div class="alert alert-block alert-danger alert-text-normal"><b>Notebooks have limited support for typesetting admons</b>
<p>Admon environments must be simulated using Markdown quote environment, a plain paragraph, or decorations with HTML
<code>&lt;hr&gt;</code> hrules.
</p>
</div>


<div class="alert alert-block alert-success alert-text-normal"><b>Splitting documents</b>
<p>Formats like <code>html</code> and <code>sphinx</code> support splitting documents into multiple web pages. The <code>!split</code> specification has no
support in notebooks. This means that long documents <em>must</em> be long notebooks.
</p>
</div>

<h1 id="equation-references" class="anchor">Equation references </h1>

<p>Markdown (and thereby the Jupyter Notebook) does not support references to equations.</p>

$$
\begin{align}
a &= 1,
\label{eq1}\\ 
b & =2
\label{eq2}
\end{align}
$$

<p>Can we refer to \eqref{eq1} and \eqref{eq2} in format <code>ipynb</code>? Yes, in DocOnce-extended <code>ipynb</code> format, but not when
writing notebooks interactively in the browser and using Markdown with LaTeX. 
</p>
<h1 id="translating-notebooks-to-doconce" class="anchor">Translating notebooks to DocOnce </h1>
<h2 id="the-ipynb2doconce-tool" class="anchor">The <code>ipynb2doconce</code> tool </h2>

<p>There is a program <code>doconce ipynb2doconce</code> for translating a notebook file to DocOnce format:</p>


<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">Terminal&gt; doconce ipynb2doconce notebook.ipynb
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>The output file <code>notebook.do.txt</code> should be an ordinary DocOnce file.
With an optional argument <code>--cell_delimiter</code>, comment lines a la <code># ---------- code cell</code> act in the as delimiter between the <em>markdown</em> and <em>code</em> cells in the
<code>.do.txt</code> file.
</p>
<h2 id="special-comment-annotations-in-the-ipynb-file" class="anchor">Special comment annotations in the <code>.ipynb</code> file </h2>

<p>In order to translate a DocOnce document to the Jupyter Notebook format
and back again, some information needs to be coded as comments
in the notebook and such that it can be brought back to DocOnce syntax.
For example, index workds (<code>idx</code>) and labels are coded in comments, so
are the original DocOnce figure and movie commands (which contain more
information than what the notebook normally can make use of).
Comments in the <code>.ipynb</code> file starting with <code>dom:</code> (DocOnce Metadata)
contain coded information that can be translated back to DocOnce (see
below for examples).
</p>

<p>It is possible to write ordinary DocOnce documents with index words, labels,
cross references, etc.; translate the document to a notebook; edit
and expand the notebook interactively; and convert the notebook to
a DocOnce document again - with preservation of index words, labels, etc.,
despite the fact that the notebook does not know about such syntax
and construction. If you want to insert title, authors, date,
index words, labels,
figures, or movies in the notebook, use these types of constructions
while writing a markdown cell in the notebook:
</p>


<!-- code=text (!bc dat) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">&lt;!-- dom:TITLE: Here goes the title --&gt;
# Here goes the title
&lt;!-- dom:AUTHOR: HPL Email:hpl@simula.no at Simula &amp; UiO --&gt;
&lt;!-- Author: --&gt; **HPL** (email: `hpl@simula.no`), Simula and UiO

&lt;!-- dom:AUTHOR: Kaare Dump at Segfault, Cyberspace --&gt;
&lt;!-- Author: --&gt; **Kaare Dump**, Segfault, Cyberspace

Date: **May 25, 2015**

# Section heading
&lt;!-- dom:label{mysubsec} --&gt;
&lt;!-- dom:idx{headigs} --&gt;
&lt;!-- dom:idx{section} --&gt;

Some text...

&lt;!-- dom:FIGURE: [fig/myfig, width=500 frac=0.6] This is a caption. --&gt;
&lt;!-- begin figure --&gt;
&lt;p&gt;This is a caption.&lt;/p&gt;
&lt;img src=&quot;fig/myfig.png&quot; width=500&gt;
&lt;!-- end figure --&gt;
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>It is important to respect whitespace exactly as shown in this example.
The <code>dom:</code> syntax must be the valid DocOnce syntax used when translating
the document back to DocOnce format, while the Markdown lines coming
after are the ones that can been seen in the present version of
the notebook (these are removed forever when converting the notebook to
DocOnce format).
</p>

<div class="alert alert-block alert-danger alert-text-normal"><b>Mako code is lost!</b>
<p>Any Preprocess or Mako code one has in a DocOnce document is lost forever when
converting to a Jupyter Notebook.
</p>
</div>


<p>As a specific example on generating a notebook and converting it back,
consider the <a href="https://github.com/hplgit/doconce/blob/master/doc/src/ipynb/example.do.txt" target="_self"><tt>example.do.txt</tt></a> file:
</p>


<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;">Terminal&gt; cp example.do.txt tmp1.do.txt
Terminal&gt; doconce format ipynb tmp1
Terminal&gt; cp tmp1.ipynb tmp2.ipynb
Terminal&gt; doconce ipynb2doconce tmp2.ipynb
Terminal&gt; doconce diff tmp1.do.txt tmp2.do.txt
Termonal&gt; google-chrome tmp_diff_tmp2.do.txt.html
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ------------------- end of main content --------------- -->
</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<!-- Bootstrap footer
<footer>
<a href="https://..."><img width="250" align=right src="https://..."></a>
</footer>
-->
</body>
</html>

